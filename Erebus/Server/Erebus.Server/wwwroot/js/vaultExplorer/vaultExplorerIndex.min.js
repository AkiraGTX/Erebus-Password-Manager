var vaultExplorerIndex=function(e){function t(e){var t,o,n="_hiddenCopyText_",r="INPUT"===e.tagName||"TEXTAREA"===e.tagName;if(r)a=e,t=e.selectionStart,o=e.selectionEnd;else{if(a=document.getElementById(n),!a){var a=document.createElement("textarea");a.style.position="absolute",a.style.left="-9999px",a.style.top="0",a.id=n,document.body.appendChild(a)}a.textContent=e.textContent}var d=document.activeElement;a.focus(),a.setSelectionRange(0,a.value.length);var i;try{i=document.execCommand("copy")}catch(s){i=!1}return d&&"function"==typeof d.focus&&d.focus(),r?e.setSelectionRange(t,o):a.textContent="",i}var o="vault-tree",n="entries-grid",r="add-group-button",a="add-sub-group-button",d="edit-group-button",i="delete-group-button",s="add-entry-button";return e.init=function(){$("#"+o).jstree({core:{data:{url:function(e){return"/VaultExplorer/GetNodeItems"},data:function(e){return{parentId:e.id}}}}}),$("#"+r).on("click",e.addGroup),$("#"+a).on("click",e.addSubGroup),$("#"+d).on("click",e.editGroup),$("#"+i).on("click",e.deleteGroup),$("#"+s).on("click",e.addEntry),$("#"+o).on("changed.jstree",e.onTreeNodeChange),$(window).on("resize",function(){$(".vault-explorer-entries-table-wrapper").height($(window).height()-$(".btn-toolbar").height())})},e.enableButtons=function(){$("#"+a).prop("disabled",!1),$("#"+d).prop("disabled",!1),$("#"+i).prop("disabled",!1),$("#"+s).prop("disabled",!1)},e.disableButtons=function(){$("#"+a).prop("disabled",!0),$("#"+d).prop("disabled",!0),$("#"+i).prop("disabled",!0),$("#"+s).prop("disabled",!0)},e.onTreeNodeChange=function(t,o){"select_node"===o.action&&(o.node?(e.enableButtons(),e.loadGroupEntries(o.node.id)):e.disableButtons())},e.loadGroupEntries=function(e){$.ajax({url:"/VaultExplorer/GroupEntriesGrid",method:"GET",data:{groupId:e}}).done(function(e){$("#"+n).html(e),sessionTimeout.reset()})},e.addGroup=function(){$.ajax({url:"/VaultExplorer/AddOrEditGroup",method:"GET",data:{parentId:"#"}}).done(function(e){$("body").append(e),sessionTimeout.reset()})},e.addSubGroup=function(){var e=$("#"+o).jstree().get_selected(!0);if(1===e.length){var t=e[0];$.ajax({url:"/VaultExplorer/AddOrEditGroup",method:"GET",data:{parentId:t.id}}).done(function(e){$("body").append(e),sessionTimeout.reset()})}},e.editGroup=function(){var e=$("#"+o).jstree().get_selected(!0);if(1===e.length){var t=e[0];$.ajax({url:"/VaultExplorer/AddOrEditGroup",method:"GET",data:{id:t.id,parentId:t.parent}}).done(function(e){$("body").append(e),sessionTimeout.reset()})}},e.deleteGroup=function(){var t=$("#"+o).jstree().get_selected(!0);if(1===t.length){var n=t[0];confirm("Group and all it's children will be deleted. Are you sure?")&&$.ajax({url:"/VaultExplorer/DeleteGroup",method:"POST",data:{id:n.id}}).done(function(){e.refreshNode(n.parent),sessionTimeout.reset()})}},e.addEntry=function(){var e=$("#"+o).jstree().get_selected(!0);if(1===e.length){var t=e[0];$.ajax({url:"/VaultExplorer/AddOrEditEntry",method:"GET",data:{parentId:t.id}}).done(function(e){$("body").append(e),sessionTimeout.reset()})}},e.editEntry=function(e){var t=$("#"+o).jstree().get_selected(!0);if(1===t.length){var n=t[0];$.ajax({url:"/VaultExplorer/AddOrEditEntry",method:"GET",data:{id:e,parentId:n.id}}).done(function(e){$("body").append(e),sessionTimeout.reset()})}},e.deleteEntry=function(t){confirm("Entry will be deleted. Are you sure?")&&$.ajax({url:"/VaultExplorer/DeleteEntry",method:"POST",data:{id:t}}).done(function(){var t=$("#"+o).jstree().get_selected(!0);if(1===t.length){var n=t[0];e.refreshNode(n.parent,n.id),e.loadGroupEntries(n.id)}sessionTimeout.reset()})},e.refreshNode=function(t,n){var r=$("#"+o).jstree(),a=r.get_node(t);r.load_node(a,function(){n?(r.select_node(n,!0),e.enableButtons()):r.get_selected().length||e.disableButtons()}),r.open_node(a)},e.submitGroupEditForm=function(t,o,n){$("#"+t).one("submit",function(t){if($(this).valid()){var r=$(this).serializeArray(),a=$(this).attr("action");$.ajax({url:a,type:"POST",data:r,success:function(t,r,a){t.success&&(e.closeModal(o),e.refreshNode(n)),sessionTimeout.reset()}})}t.preventDefault()}),$("#"+t).submit()},e.submitEntryEditForm=function(t,n,r){$("#"+t).one("submit",function(t){if($(this).valid()){var a=$(this).serializeArray(),d=$(this).attr("action");$.ajax({url:d,type:"POST",data:a,success:function(t,a,d){if(t.success){e.closeModal(n);var i=$("#"+o).jstree(),s=i.get_node(r);e.refreshNode(s.parent,s.id),e.loadGroupEntries(r)}sessionTimeout.reset()}})}t.preventDefault()}),$("#"+t).submit()},e.closeModal=function(e){$("#"+e).modal("hide")},e.toggleShowPassword=function(e,t){"password"===$("#"+t).prop("type")?($("#"+t).prop("type","text"),$(e).addClass("btn-warning"),$(e).removeClass("btn-primary"),$(e).find("span").addClass("glyphicon-eye-close"),$(e).find("span").removeClass("glyphicon-eye-open")):($("#"+t).prop("type","password"),$(e).addClass("btn-primary"),$(e).removeClass("btn-warning"),$(e).find("span").addClass("glyphicon-eye-open"),$(e).find("span").removeClass("glyphicon-eye-close"))},e.copyPassword=function(e,o){"password"===$("#"+o).prop("type")?($("#"+o).prop("type","text"),t($("#"+o)[0]),$("#"+o).prop("type","password")):t($("#"+o)[0]),$.notify("Copied!",{autoHide:!0,autoHideDelay:1500,className:"info",position:"top center"})},e.generatePassword=function(e){$.ajax({url:"/VaultExplorer/GeneratePassword",method:"GET",data:{id:e}}).done(function(e){$("body").append(e),sessionTimeout.reset()})},e.submitGeneratePasswordForm=function(e,t){$("#"+e).one("submit",function(e){if($(this).valid()){var o=$(this).serializeArray(),n=$(this).attr("action");$.ajax({url:n,type:"POST",data:o,success:function(e,o,n){e.success&&$("#"+t).val(e.password),sessionTimeout.reset()}})}e.preventDefault()}),$("#"+e).submit()},e.acceptGeneratedPassword=function(t,o,n){$("#"+o).val($("#"+n).val()),e.closeModal(t)},e}(vaultExplorerIndex||{});$(function(){vaultExplorerIndex.init()});