var vaultExplorerIndex=function(e){function t(e){var t,n,o="_hiddenCopyText_",d="INPUT"===e.tagName||"TEXTAREA"===e.tagName;if(d)r=e,t=e.selectionStart,n=e.selectionEnd;else{if(r=document.getElementById(o),!r){var r=document.createElement("textarea");r.style.position="absolute",r.style.left="-9999px",r.style.top="0",r.id=o,document.body.appendChild(r)}r.textContent=e.textContent}var a=document.activeElement;r.focus(),r.setSelectionRange(0,r.value.length);var i;try{i=document.execCommand("copy")}catch(l){i=!1}return a&&"function"==typeof a.focus&&a.focus(),d?e.setSelectionRange(t,n):r.textContent="",i}var n="vault-tree",o="entries-grid",d="add-group-button",r="add-sub-group-button",a="edit-group-button",i="delete-group-button",l="add-entry-button";return e.init=function(){$("#"+n).jstree({core:{data:{url:function(e){return"/VaultExplorer/GetNodeItems"},data:function(e){return{parentId:e.id}}}}}),$("#"+d).on("click",e.addGroup),$("#"+r).on("click",e.addSubGroup),$("#"+a).on("click",e.editGroup),$("#"+i).on("click",e.deleteGroup),$("#"+l).on("click",e.addEntry),$("#"+n).on("changed.jstree",e.onTreeNodeChange)},e.enableButtons=function(){$("#"+r).prop("disabled",!1),$("#"+a).prop("disabled",!1),$("#"+i).prop("disabled",!1),$("#"+l).prop("disabled",!1)},e.disableButtons=function(){$("#"+r).prop("disabled",!0),$("#"+a).prop("disabled",!0),$("#"+i).prop("disabled",!0),$("#"+l).prop("disabled",!0)},e.onTreeNodeChange=function(t,n){"select_node"===n.action&&(n.node?(e.enableButtons(),e.loadGroupEntries(n.node.id)):e.disableButtons())},e.loadGroupEntries=function(e){$.ajax({url:"/VaultExplorer/GroupEntriesGrid",method:"GET",data:{groupId:e}}).done(function(e){$("#"+o).html(e)})},e.addGroup=function(){$.ajax({url:"/VaultExplorer/AddOrEditGroup",method:"GET",data:{parentId:"#"}}).done(function(e){$("body").append(e)})},e.addSubGroup=function(){var e=$("#"+n).jstree().get_selected(!0);if(1===e.length){var t=e[0];$.ajax({url:"/VaultExplorer/AddOrEditGroup",method:"GET",data:{parentId:t.id}}).done(function(e){$("body").append(e)})}},e.editGroup=function(){var e=$("#"+n).jstree().get_selected(!0);if(1===e.length){var t=e[0];$.ajax({url:"/VaultExplorer/AddOrEditGroup",method:"GET",data:{id:t.id,parentId:t.parent}}).done(function(e){$("body").append(e)})}},e.deleteGroup=function(){var t=$("#"+n).jstree().get_selected(!0);if(1===t.length){var o=t[0];confirm("Group and all it's children will be deleted. Are you sure?")&&$.ajax({url:"/VaultExplorer/DeleteGroup",method:"POST",data:{id:o.id}}).done(function(){e.refreshNode(o.parent)})}},e.addEntry=function(){var e=$("#"+n).jstree().get_selected(!0);if(1===e.length){var t=e[0];$.ajax({url:"/VaultExplorer/AddOrEditEntry",method:"GET",data:{parentId:t.id}}).done(function(e){$("body").append(e)})}},e.editEntry=function(e){var t=$("#"+n).jstree().get_selected(!0);if(1===t.length){var o=t[0];$.ajax({url:"/VaultExplorer/AddOrEditEntry",method:"GET",data:{id:e,parentId:o.id}}).done(function(e){$("body").append(e)})}},e.deleteEntry=function(t){confirm("Entry will be deleted. Are you sure?")&&$.ajax({url:"/VaultExplorer/DeleteEntry",method:"POST",data:{id:t}}).done(function(){var t=$("#"+n).jstree().get_selected(!0);if(1===t.length){var o=t[0];e.refreshNode(o.parent,o.id),e.loadGroupEntries(o.id)}})},e.refreshNode=function(t,o){var d=$("#"+n).jstree(),r=d.get_node(t);d.load_node(r,function(){o?(d.select_node(o,!0),e.enableButtons()):d.get_selected().length||e.disableButtons()}),d.open_node(r)},e.submitGroupEditForm=function(t,n,o){$("#"+t).submit(function(t){if($(this).valid()){var d=$(this).serializeArray(),r=$(this).attr("action");$.ajax({url:r,type:"POST",data:d,success:function(t,d,r){t.success&&(e.closeModal(n),e.refreshNode(o))}})}t.preventDefault()}),$("#"+t).submit()},e.submitEntryEditForm=function(t,o,d){$("#"+t).submit(function(t){if($(this).valid()){var r=$(this).serializeArray(),a=$(this).attr("action");$.ajax({url:a,type:"POST",data:r,success:function(t,r,a){if(t.success){e.closeModal(o);var i=$("#"+n).jstree(),l=i.get_node(d);e.refreshNode(l.parent,l.id),e.loadGroupEntries(d)}}})}t.preventDefault()}),$("#"+t).submit()},e.closeModal=function(e){$("#"+e).on("hidden.bs.modal",function(){$("#"+e).remove()}),$("#"+e).modal("hide")},e.toggleShowPassword=function(e,t){"password"===$("#"+t).prop("type")?($("#"+t).prop("type","text"),$(e).addClass("btn-warning"),$(e).removeClass("btn-primary"),$(e).find("span").addClass("glyphicon-eye-close"),$(e).find("span").removeClass("glyphicon-eye-open")):($("#"+t).prop("type","password"),$(e).addClass("btn-primary"),$(e).removeClass("btn-warning"),$(e).find("span").addClass("glyphicon-eye-open"),$(e).find("span").removeClass("glyphicon-eye-close"))},e.copyPassword=function(e){"password"===$("#"+e).prop("type")?($("#"+e).prop("type","text"),t($("#"+e)[0]),$("#"+e).prop("type","password")):t($("#"+e)[0])},e}(vaultExplorerIndex||{});$(function(){vaultExplorerIndex.init()});