var vaultExplorerIndex=function(e){var t="vault-tree",d="entries-grid",r="add-group-button",n="add-sub-group-button",o="edit-group-button",a="delete-group-button",i="add-entry-button";return e.init=function(){$("#"+t).jstree({core:{data:{url:function(e){return"/VaultExplorer/GetNodeItems"},data:function(e){return{parentId:e.id}}}}}),$("#"+r).on("click",e.addGroup),$("#"+n).on("click",e.addSubGroup),$("#"+o).on("click",e.editGroup),$("#"+a).on("click",e.deleteGroup),$("#"+i).on("click",e.addEntry),$("#"+t).on("changed.jstree",e.onTreeNodeChange)},e.onTreeNodeChange=function(t,d){"select_node"===d.action&&(d.node?($("#"+n).prop("disabled",!1),$("#"+o).prop("disabled",!1),$("#"+a).prop("disabled",!1),$("#"+i).prop("disabled",!1),e.loadGroupEntries(d.node.id)):($("#"+n).prop("disabled",!0),$("#"+o).prop("disabled",!0),$("#"+a).prop("disabled",!0),$("#"+i).prop("disabled",!0)))},e.loadGroupEntries=function(e){$.ajax({url:"/VaultExplorer/GroupEntriesGrid",method:"GET",data:{groupId:e}}).done(function(e){$("#"+d).html(e)})},e.addGroup=function(){$.ajax({url:"/VaultExplorer/AddOrEditGroup",method:"GET",data:{parentId:"#"}}).done(function(e){$("body").append(e)})},e.addSubGroup=function(){var e=$("#"+t).jstree().get_selected(!0);if(1===e.length){var d=e[0];$.ajax({url:"/VaultExplorer/AddOrEditGroup",method:"GET",data:{parentId:d.id}}).done(function(e){$("body").append(e)})}},e.editGroup=function(){var e=$("#"+t).jstree().get_selected(!0);if(1===e.length){var d=e[0];$.ajax({url:"/VaultExplorer/AddOrEditGroup",method:"GET",data:{id:d.id,parentId:d.parent}}).done(function(e){$("body").append(e)})}},e.deleteGroup=function(){var d=$("#"+t).jstree().get_selected(!0);if(1===d.length){var r=d[0];confirm("Group and all it's children will be deleted. Are you sure?")&&$.ajax({url:"/VaultExplorer/DeleteGroup",method:"POST",data:{id:r.id}}).done(function(){e.refreshNode(r.parent)})}},e.addEntry=function(){var e=$("#"+t).jstree().get_selected(!0);if(1===e.length){var d=e[0];$.ajax({url:"/VaultExplorer/AddOrEditEntry",method:"GET",data:{parentId:d.id}}).done(function(e){$("body").append(e)})}},e.editEntry=function(e){var d=$("#"+t).jstree().get_selected(!0);if(1===d.length){var r=d[0];$.ajax({url:"/VaultExplorer/AddOrEditEntry",method:"GET",data:{id:e,parentId:r.id}}).done(function(e){$("body").append(e)})}},e.deleteEntry=function(d){confirm("Entry will be deleted. Are you sure?")&&$.ajax({url:"/VaultExplorer/DeleteEntry",method:"POST",data:{id:d}}).done(function(){var d=$("#"+t).jstree().get_selected(!0);if(1===d.length){var r=d[0];e.refreshNode(r.parent),e.loadGroupEntries(r.id)}})},e.refreshNode=function(e){var d=$("#"+t).jstree(),r=d.get_node(e);d.load_node(r),d.open_node(r)},e.submitEditForm=function(d,r,n,o){$("#"+d).submit(function(d){if($(this).valid()){var a=$(this).serializeArray(),i=$(this).attr("action");$.ajax({url:i,type:"POST",data:a,success:function(d,a,i){if(d.success){e.closeModal(r);var u=$("#"+t).jstree(),l=u.get_node(n);e.refreshNode(l.parent),o&&e.loadGroupEntries(n)}}})}d.preventDefault()}),$("#"+d).submit()},e.closeModal=function(e){$("#"+e).on("hidden.bs.modal",function(){$("#"+e).remove()}),$("#"+e).modal("hide")},e}(vaultExplorerIndex||{});$(function(){vaultExplorerIndex.init()});